<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Arduino servo</title>
  </head>
  <body>
    <script src="https://app.protobject.com/framework/p.js"></script>
    <script src="config.js"></script>
    <h1>Arduino servo control</h1>
    <script>
      Protobject.Arduino.start();

      // Ángulo actual del servo
      let currentAngle = 0; // Valor inicial del ángulo actual
      let targetAngle = 0; // Valor hacia el que se quiere mover el servo
      let updateInterval = null; // Variable para almacenar el intervalo de actualización

      // Función para actualizar gradualmente el ángulo del servo
      function smoothUpdateServo(target) {
        if (updateInterval) {
          clearInterval(updateInterval); // Detiene cualquier intervalo previo si está activo
        }

        updateInterval = setInterval(() => {
          // Si el ángulo actual es menor que el objetivo, incrementa
          if (currentAngle < target) {
            currentAngle=currentAngle+4;
          }
          // Si el ángulo actual es mayor que el objetivo, decrementa
          else if (currentAngle > target) {
            currentAngle=currentAngle-4;
          }
          // Si el ángulo actual es igual al objetivo, detiene el intervalo
          else {
            clearInterval(updateInterval); // Detiene el intervalo cuando se alcanza el objetivo
            updateInterval = null;
          }

          // Escribe el ángulo actual al servo
          Protobject.Arduino.servoWrite({ pin: 6, value: currentAngle });
        }, 10); // Actualiza el ángulo cada 10 ms
      }

      // Evento que se activa al recibir datos
      Protobject.Core.onReceived((data) => {
          
          let speed=(data.speed * 15)
          console.log(speed)
          if (speed>0) speed=speed+30;
          //Protobject.Arduino.contServoWrite({ pin: 6, value: speed });
          smoothUpdateServo(speed); // Actualiza el ángulo de forma gradual
        
      });
    </script>
  </body>
</html>
